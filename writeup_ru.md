[//]: # (Image References)

[image1]: ./my_images/bar_chart_before.png "Dataset before"
[image2]: ./my_images/bar_chart_after.png "Dataset after"
[image3]: ./my_images/affine_trans.png "affine transforma"
[image4]: ./my_images/perspective_trans.png "perspective transform"
[image5]: ./my_images/to_gray.png "to gray scale"
[image6]: ./my_images/1.png "Traffic Sign 1"
[image7]: ./my_images/2.png "Traffic Sign 2"
[image8]: ./my_images/3.png "Traffic Sign 3"
[image9]: ./my_images/4.png "Traffic Sign 4"
[image10]: ./my_images/5.png "Traffic Sign 5"
[image11]: ./my_images/6.png "Traffic Sign 6"
[image12]: ./my_images/7.png "Traffic Sign 7"
[image13]: ./my_images/8.png "Traffic Sign 8"
[image001]: ./my_images/001.png
[image002]: ./my_images/002.png

### Введение
Данный проект выполнен в рамках Nano degree программы "Self driving car" [Udacity](https://www.udacity.com/drive).
Суть данного проекта: классификация дорожных знаков Германии.

### Немного о данных

Набор данных представляет из себя базу дорожных знаков Германии. Саму базу можно скачать [сдесь]().
Я использовал Pandas и Numpy для получения статистики о данных: 

* Количество тренировочных данных 34799 дорожных знаков
* Количество данных, на которых проводилась валидация, 4410 дорожных знаков
* Количество тестовых данных 12630 дорожных знаков
* Каждый дорожный знак представляет из себя RGB картинку размером 32 x 32 x 3
* Все дорожные знаки сгруппированы в 43 класса

#### Сводная информация о данных.

На русунке ниже представлен BarChart показывающий распределение дорожных знаков в по классам.

![alt text][image1]

Можно видеть, что мы имеем дело с несбалансированным набором данных. Дисбаланс достигает 10 кратной разницы
между минимум (180) и максимум (2010). Не сбалансированные данные - это беда нейронных сетей.
Потому что, при малом количестве примеров сеть не может правильно обобщить, а вместо этого просто запомнит 
запомнить предоставленные примеры. Поэтому, для начала, мы должны расширить наш набор данных для получения 
более сбалансированного набора данных.

### Разработка и тестирование модели

#### Предобработка данных
Для получения данных с которыми может работать наша модель я сделал несколько действий.
Во первых, все картинки были преобразованы к цветовой схеме градаций серого.

![alt text][image5]

Во вторых, набор данных был расширин, добавлением в каждый класс новых, сгенерированные на основе существующих, картинок.
Количество картинок подбиралось таким образом, что бы получить в результате сбалансированный набор данных.
Для генерации использовались несколько техник:
Первое - это афинное преобразование.

![alt text][image3]

Второе - это горизонтальная и вертикальная трансформация перспективы.

![alt text][image4]

Как результат, после всех преобразований, был получен набор данных представленный на рисунке ниже.

![alt text][image2]

Новый набор данных имеет равное количество дорожных знаков для всех классов и составляет 4020 картинок для каждого класса.

#### Финальный вариант архитектуры нейронной сети.

Мой вариант нейронной сети содержит нижеследующие слои:

| Layer         		|     Description	        					| 
|:---------------------:|:---------------------------------------------:| 
| Input         		| 32x32x1 GrayScale image                       |
| Convolution 1x1   	| 1x1 stride, valid padding, outputs 32x32x3    |
| Convolution 3x3       | 1x1 stride, valid padding, outputs 30x30x32   |
| ReLU			        |												|
| Convolution 3x3       | 1x1 stride, valid padding, outputs 28x28x64   |
| ReLU                  |                                               |
| Max pooling           | 2x2 stride, outputs 14x14x64                  |
| Convalution 5x5       | 1x1 stride, valid padding, outputs 10x10x128  |
| ReLU                  |                                               |
| Max pooling	      	| 2x2 stride, outputs 5x5x128                   |
| Fully connected       | outputs 3200                                  |
| Fully connected       | outputs 1024                                  |
| ReLU                  |                                               |
| Fully connected       | outputs 120                                   |
| ReLU                  |                                               |
| Fully conneted        | outputs 84                                    |
| ReLU                  |                                               |
| Fully connected       | outputs 10        							|

#### Обучение модели.

Для обучения модели я использовал следующие параметры:
* learning rate: 0.001
* Optimazer: Adam optimizer
* Epochs = 10
* Batch size = 128

В итоге я получил следующие результаты:
* validation test accuracy = 0.980
* test set accuracy = 0.971

Для начала я пробовал LeNet-5 архитектуру по рекомендации Udacity, и после проведенных экспериментов я был удовлетворен результатом test set accuracy = 0.937, но хотел большего.
Я стал экспериментировать с добавлением новых сверточных слоев, а так же играть количеством фильтров.
В итоге я пришел к финальной архитектуре сети, котарая показала достаточно хорошие результаты. В целом я понимаю, что продолжая эксперименты можно добиться более высокого качества распознавания.

### Тестирование модели на новых данных

#### 8 дорожных знаков германии.

Ниже представлены 8 картинок дорожных знаков которые мне удалось найти в интернете:

![alt text][image6] ![alt text][image7] ![alt text][image8] 
![alt text][image9] ![alt text][image10] ![alt text][image11]
![alt text][image12] ![alt text][image13]

#### Проблемы при распознавании новых примеров

Предварительно все картинки были сконвертированы в GrayScale цветовую гамму, как того требует модель.
Как результат, для данной модели не составило труда распознать все 8 примеров.

Результаты представлены ниже.
![alt text][image001]
![alt text][image002]

